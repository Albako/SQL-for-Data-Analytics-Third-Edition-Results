
-- Question 2
select 
	sales_transaction_date::date, 
	count(*) unit_sold
from sales
group by sales_transaction_date::date;


-- Question 3
with 
	daily_unit_sold as (
		select 
			sales_transaction_date::date, 
			count(*) unit_sold
		from sales
		group by sales_transaction_date::date
	)
select 
	sales_transaction_date,
	unit_sold,
	avg(unit_sold) over w as moving_avg
from daily_unit_sold 
window w as (
	ORDER BY sales_transaction_date 
	ROWS BETWEEN 6 PRECEDING AND 3 FOLLOWING
)
order by 1;

-- Question 4
with 
	daily_unit_sold as (
		select 
			sales_transaction_date::date, 
			count(*) unit_sold
		from sales
		group by sales_transaction_date::date
	),
	moving_avg as (
		select 
			sales_transaction_date,
			unit_sold,
			avg(unit_sold) over w as moving_avg
		from daily_unit_sold 
		window w as (
			ORDER BY sales_transaction_date 
			ROWS BETWEEN 6 PRECEDING AND 3 FOLLOWING
		)
	)
select 
	sales_transaction_date,
	unit_sold,
	moving_avg,
	RANK() over (ORDER BY moving_avg DESC) as rnk
from moving_avg m
order by rnk;
